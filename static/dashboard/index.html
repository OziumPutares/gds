<!doctype html>
<html lang="en" class="govuk-template js-enabled">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, viewport-fit=cover"
    />
    <meta name="theme-color" content="#0b0c0c" />
    <title>Sign in using Government Gateway - GOV.UK</title>

    <!-- Favicons -->
    <link rel="icon" sizes="48x48" href="assets/images/favicon.ico" />
    <link
      rel="icon"
      sizes="any"
      href="assets/images/favicon.svg"
      type="image/svg+xml"
    />
    <link
      rel="mask-icon"
      href="assets/images/govuk-icon-mask.svg"
      color="#0b0c0c"
    />

    <!-- Stylesheets -->
    <link rel="stylesheet" href="css/govuk-frontend.min.css" />
    <link rel="stylesheet" href="css/scp.css" />

    <!-- JavaScript -->
    <script src="js/page-start.js" defer></script>
  </head>
  <body class="govuk-template__body govuk-frontend-supported">
    <!-- Header -->
    <header class="govuk-header" role="banner">
      <div class="govuk-header__container govuk-width-container">
        <div class="govuk-header__logo">
          <a
            href="https://www.gov.uk"
            class="govuk-header__link govuk-header__link--homepage"
          >
            <svg
              role="img"
              focusable="false"
              class="govuk-header__logotype"
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 148 30"
              height="30"
              width="148"
              aria-label="GOV.UK"
            >
              <title>GOV.UK</title>
              <path d="..."></path>
            </svg>
          </a>
        </div>
      </div>
    </header>

    <!-- Main Content -->
    <div class="govuk-width-container">
      <main
        class="govuk-main-wrapper govuk-!-padding-top-4"
        id="main-content"
        role="main"
      >
        <h1 class="govuk-heading-xl">Your data</h1>
        <!-- Dashboard container with GOV.UK styling classes -->
        <div id="dashboard-container" class="govuk-grid-row">
          <!-- Loading state with GOV.UK styling -->
          <div class="govuk-grid-column-full">
            <div class="govuk-body">Loading your dashboard...</div>
          </div>
        </div>

        <script>
          async function loadDashboard() {
            try {
              const response = await fetch("/api/dashboard");
              const html = await response.text();

              // Create a temporary container to parse the incoming HTML
              const tempContainer = document.createElement("div");
              tempContainer.innerHTML = html;

              // Ensure any elements from the API response get GOV.UK classes
              const elements = tempContainer.getElementsByTagName("*");
              for (const element of elements) {
                // Add GOV.UK classes based on element type
                if (element.tagName === "H2") {
                  element.classList.add("govuk-heading-m");
                } else if (element.tagName === "P") {
                  element.classList.add("govuk-body");
                } else if (element.tagName === "TABLE") {
                  element.classList.add("govuk-table");
                }
                // Add more element types as needed
              }

              // Update the dashboard container with the processed HTML
              document.getElementById("dashboard-container").innerHTML =
                tempContainer.innerHTML;
            } catch (error) {
              // Show error with GOV.UK styling
              document.getElementById("dashboard-container").innerHTML = `
                <div class="govuk-grid-column-full">
                  <div class="govuk-error-summary" role="alert">
                    <h2 class="govuk-error-summary__title">There is a problem</h2>
                    <div class="govuk-error-summary__body">
                      <p>Failed to load dashboard. Please try again later.</p>
                    </div>
                  </div>
                </div>`;
              console.error("Failed to load dashboard:", error);
            }
          }

          // Load dashboard when page loads
          loadDashboard();
        </script>
      </main>
    </div>

    <!-- Footer -->
    <footer class="govuk-footer" role="contentinfo">
      <div class="govuk-width-container">
        <div class="govuk-footer__meta">
          <ul class="govuk-footer__inline-list">
            <li class="govuk-footer__inline-list-item">
              <a href="/accessibility" class="govuk-footer__link"
                >Accessibility</a
              >
            </li>
            <li class="govuk-footer__inline-list-item">
              <a href="/cookies" class="govuk-footer__link">Cookies</a>
            </li>
            <li class="govuk-footer__inline-list-item">
              <a href="/privacy" class="govuk-footer__link">Privacy</a>
            </li>
            <li class="govuk-footer__inline-list-item">
              <a href="/terms" class="govuk-footer__link">Terms</a>
            </li>
          </ul>
          <span class="govuk-footer__licence-description">
            All content is available under the
            <a
              href="https://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/"
              class="govuk-footer__link"
              >Open Government Licence v3.0</a
            >, except where otherwise stated.
          </span>
        </div>
      </div>
    </footer>

    <!-- JavaScript -->
    <script src="js/page-complete.js" defer></script>
    <script src="js/device-profile.js" defer></script>
  </body>
</html>
